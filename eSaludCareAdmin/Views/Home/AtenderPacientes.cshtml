@{
    ViewBag.Title = "Pacientes Registrados | eSaludCare";
}

<div class="container mt-4">
    <h3 class="text-primary mb-4">Pacientes Registrados</h3>

    <div class="table-responsive shadow-sm">
        <table class="table table-hover" id="tablaPacientes">
            <thead class="table-primary">
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Teléfono</th>
                    <th>Género</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        cargarPacientes();
    });

    function cargarPacientes() {
        fetch("/api/v1/pacientes/listar")
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector("#tablaPacientes tbody");
                tbody.innerHTML = "";
                data.forEach(p => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${p.IdPaciente}</td>
                            <td>${p.nombre} ${p.apellido}</td>
                            <td>${p.correo}</td>
                            <td>${p.telefono || '-'}</td>
                            <td>${p.genero || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary"
                                        onclick="seleccionarPaciente(${p.IdPaciente}, '${p.nombre} ${p.apellido}')">
                                    Atender
                                </button>
                            </td>
                        </tr>`;
                });
            })
            .catch(err => {
                console.error("Error al cargar pacientes:", err);
                alert("No se pudieron cargar los pacientes.");
            });
    }

    function seleccionarPaciente(id, nombre) {
        localStorage.setItem("id_paciente", id);
        localStorage.setItem("nombre_paciente", nombre);
        alert(`Atendiendo ahora a: ${nombre}`);
        window.location.href = "/HistorialClinico/HistorialClínico";
    }
</script>
